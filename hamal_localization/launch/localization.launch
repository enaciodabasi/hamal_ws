<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <arg name="use_madgwick" default="false"></arg>
    <arg name="use_complementary_filter" default="false"></arg>

    <include file="$(find ros_openimu)/launch/openimu_driver.launch"></include>

    <group if="$(arg use_complementary_filter)">
        <node pkg="imu_complementary_filter" type="complementary_filter_node" name="complementary_filter_gain_node" output="screen">
            <param name="do_bias_estimation" value="true"/>
            <param name="do_adaptive_gain" value="true"/>
            <param name="use_mag" value="false"/>
            <param name="gain_acc" value="0.01"/>
            <param name="gain_mag" value="0.01"/>
        </node>
    </group>

    <group if="$(arg use_madgwick)">

    <node pkg="nodelet" type="nodelet" name="imu_manager"
    args="manager" output="screen" />
    <node 
        pkg="nodelet" 
        type="nodelet" 
        name="ImuFilterNodelet" 
        args="load imu_filter_madgwick/ImuFilterNodelet imu_manager"
        output="screen"
    >

      <param name="publish_tf" value="false"/>

    </node>
    </group>

    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization_node" clear_params="true">
        <rosparam command="load" file="$(find hamal_localization)/config/rl_ekf.yaml" />
    
        <!--  Placeholder for output topic remapping
        <remap from="odometry/filtered" to=""/>
        <remap from="accel/filtered" to=""/>
        -->
    
    </node>
    
</launch>